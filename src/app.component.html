
<main class="min-h-screen w-full flex items-center justify-center p-4 bg-gray-900 font-sans">
  <div class="w-full max-w-4xl mx-auto">
    <header class="text-center mb-8">
      <h1 class="text-4xl sm:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-teal-400">
        AI ATS Score
      </h1>
      <p class="mt-2 text-lg text-gray-400">
        Elevate your resume with instant, AI-powered analysis.
      </p>
    </header>

    <div class="relative bg-gray-800/70 border border-gray-700 rounded-2xl shadow-2xl shadow-teal-900/20 p-6 sm:p-8 backdrop-blur-sm">
      
      <!-- Mode Switcher -->
      <div class="mb-6">
        <div class="flex border-b border-gray-700">
          <button 
            (click)="setMode('single')"
            class="px-4 py-2 -mb-px font-semibold text-sm sm:text-base border-b-2 transition-colors duration-300"
            [class.text-emerald-400]="mode() === 'single'"
            [class.border-emerald-400]="mode() === 'single'"
            [class.text-gray-400]="mode() !== 'single'"
            [class.border-transparent]="mode() !== 'single'"
            [class.hover:text-emerald-300]="mode() !== 'single'">
            Single Resume Analysis
          </button>
          <button 
            (click)="setMode('bulk')"
            class="px-4 py-2 -mb-px font-semibold text-sm sm:text-base border-b-2 transition-colors duration-300"
            [class.text-emerald-400]="mode() === 'bulk'"
            [class.border-emerald-400]="mode() === 'bulk'"
            [class.text-gray-400]="mode() !== 'bulk'"
            [class.border-transparent]="mode() !== 'bulk'"
            [class.hover:text-emerald-300]="mode() !== 'bulk'">
            Bulk Shortlisting
          </button>
        </div>
      </div>

      <!-- Job Description Input for Bulk Mode -->
      @if (mode() === 'bulk' && (status() === 'idle' || status() === 'files-selected')) {
        <div class="mb-6 bg-gray-900/50 p-4 rounded-xl border border-gray-700">
          <label for="job-description" class="block text-sm font-medium text-emerald-300">
            Optional: Paste Job Description for Contextual Analysis
          </label>
          <p class="mt-1 text-xs text-gray-400">
            Providing a job description allows the AI to score resumes based on their specific relevance to the role, yielding more accurate results.
          </p>
          <textarea 
            id="job-description" 
            rows="4"
            class="mt-2 block w-full rounded-md bg-gray-800 border-gray-600 shadow-sm focus:border-emerald-500 focus:ring-emerald-500 text-gray-200 sm:text-sm transition"
            placeholder="e.g., Senior Frontend Developer with 5+ years of experience in Angular, TypeScript, and state management..."
            [value]="jobDescription()"
            (input)="jobDescription.set($any($event.target).value)">
          </textarea>
        </div>
      }

      @switch (status()) {
        @case ('idle') {
          <app-file-uploader 
            [multiple]="mode() === 'bulk'" 
            (filesSelected)="handleFilesSelected($event)">
          </app-file-uploader>
        }
        @case ('files-selected') {
          <div class="flex flex-col items-center">
            <h2 class="text-xl font-semibold text-gray-200 mb-4">
              {{ selectedFiles().length }} File(s) Ready for Analysis
            </h2>

            <div class="w-full max-h-60 overflow-y-auto bg-gray-900/50 rounded-lg border border-gray-700 p-3 mb-4 space-y-2">
              @for (file of selectedFiles(); track file.name) {
                <div class="flex justify-between items-center text-sm bg-gray-800/60 p-2 pl-4 rounded-md animate-fade-in-fast">
                  <span class="text-gray-300 truncate pr-4" [title]="file.name">{{ file.name }}</span>
                  <div class="flex items-center flex-shrink-0">
                    <span class="text-gray-500 mr-3">{{ (file.size / 1024).toFixed(1) }} KB</span>
                    <button (click)="removeFile(file.name)" class="p-1 text-gray-500 hover:text-red-400 rounded-full hover:bg-red-900/30 transition-colors" title="Remove file">
                      <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" /></svg>
                    </button>
                  </div>
                </div>
              }
            </div>
            
            @if (error()) {
              <div class="my-2 p-3 w-full bg-red-900/30 border border-red-500/50 rounded-lg text-red-300 text-sm text-center">
                {{ error() }}
              </div>
            }

            <div class="flex flex-col sm:flex-row gap-4 w-full justify-center mt-4">
              <button (click)="startAnalysis()" class="bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-3 px-8 rounded-lg transition-colors duration-300 text-lg shadow-lg shadow-emerald-900/50">
                Analyze {{ selectedFiles().length }} File(s)
              </button>
              
              @if (mode() === 'bulk') {
                <button (click)="addMoreFilesInput.click()" class="bg-gray-700 hover:bg-gray-600 text-emerald-400 font-bold py-3 px-6 rounded-lg transition-colors duration-300">
                  Add More Files...
                </button>
                <input #addMoreFilesInput type="file" class="hidden" (change)="addMoreFiles($event)" [multiple]="true" accept=".pdf, .png, .jpg, .jpeg, .webp">
              }
            </div>

            <button (click)="reset()" class="mt-6 text-sm text-gray-500 hover:text-gray-300 transition-colors">
              Cancel & Start Over
            </button>
          </div>
        }
        @case ('loading') {
          <div class="flex flex-col items-center justify-center min-h-[200px]">
            <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-700 h-12 w-12 mb-4 animate-spin"></div>
            <h2 class="text-xl font-semibold text-emerald-400">Analyzing...</h2>
            <p class="text-gray-400 mt-2">The AI is reviewing your resume(s). Please wait.</p>
          </div>
        }
        @case ('success') {
          @if (mode() === 'single' && results().length > 0 && results()[0].status === 'success') {
            <app-score-display [result]="results()[0].result"></app-score-display>
            <div class="text-center mt-8">
              <button (click)="reset()" class="bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-2 px-5 rounded-lg transition-colors duration-300">
                Analyze Another Resume
              </button>
            </div>
          } @else if (mode() === 'bulk') {
            <app-bulk-results [results]="results()" (reset)="reset()"></app-bulk-results>
          } @else if (results().length > 0 && results()[0].status === 'error') {
            <!-- Handle single file error after analysis -->
             <div class="text-center p-8 bg-red-900/20 border border-red-500/30 rounded-lg">
              <h3 class="text-2xl font-bold text-red-400">Analysis Failed</h3>
              <p class="mt-2 text-red-300 max-w-xl mx-auto">{{ results()[0].error }}</p>
              <button (click)="reset()" class="mt-6 bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-2 px-6 rounded-lg transition-colors duration-300">
                Try Again
              </button>
            </div>
          }
        }
        @case ('error') {
          <div class="text-center p-8 bg-red-900/20 border border-red-500/30 rounded-lg">
            <h3 class="text-2xl font-bold text-red-400">An Error Occurred</h3>
            <p class="mt-2 text-red-300 max-w-xl mx-auto">{{ error() }}</p>
            <button (click)="reset()" class="mt-6 bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-2 px-6 rounded-lg transition-colors duration-300">
              Try Again
            </button>
          </div>
        }
      }
    </div>
  </div>
</main>
